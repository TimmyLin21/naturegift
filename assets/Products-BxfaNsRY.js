import{a as x,d as P,g as k}from"./alertMixin-DyMZh6iB.js";import{l as w}from"./loadingMixin-CrgvWKu1.js";import{P as S}from"./Pagination-Bzx8p2PF.js";import{S as C}from"./SkeletonProduct-CSurpvWL.js";import{_ as L,c as l,o as a,b as s,g as b,w as u,n as f,F as m,r as p,f as N,t as n,B as A,d as y,a as q,j as F}from"./index-KAsS_BkG.js";const T={data(){return{category:{categories:["Nuts","Beans","Spices","On Sale"],selected:"All"},sort:{sorts:["Name","Price: low to high","Price: high to low"],selected:"Please select",isShow:!1},products:[],pagination:[],allProducts:[],cacheProducts:[],data:{product_id:"",qty:1},favProducts:[],isLoading:!1}},components:{Pagination:S,SkeletonProduct:C},created(){this.getAllProducts(),this.$emitter.on("send-request",this.handleSendRequest),this.favProducts=JSON.parse(localStorage.getItem("favList"))||[]},unmounted(){this.$emitter.off("send-request",this.handleSendRequest)},mixins:[x,w],computed:{total_pages(){return this.category.selected!=="All"?Math.ceil(this.cacheProducts.length/9):Math.ceil(this.allProducts.length/9)}},methods:{handleSendRequest(e){this.getProducts(e,this.category.selected,this.sort.selected)},chooseSort(e){this.sort.selected=e,this.sort.isShow=!this.sort.isShow,this.getProducts(1,this.category.selected,e)},chooseCategory(e){this.category.selected=e,this.getProducts(1,e)},getAllProducts(){this.isLoading=!0,k().then(e=>{this.isLoading=!1,this.allProducts=e.data.products,Object.keys(this.$route.query).length!==0?this.chooseCategory(this.$route.query.category):this.getProducts()}).catch(()=>{this.isLoading=!1,this.alert.msg="Fail to get the products",this.alert.state=!1,this.sendMsg()})},getProducts(e=1,r="All",c){this.isLoading=!0,setTimeout(()=>{c==="Name"?this.allProducts.sort((o,d)=>o.title.localeCompare(d.title)):c==="Price: low to high"?this.allProducts.sort((o,d)=>o.price-d.price):c==="Price: high to low"&&this.allProducts.sort((o,d)=>d.price-o.price),r==="On Sale"?(this.cacheProducts=this.allProducts.filter(o=>o.price!==o.origin_price),this.products=this.cacheProducts.slice(e*9-9,e*9)):r!=="All"?(this.cacheProducts=this.allProducts.filter(o=>o.category===r),this.products=this.cacheProducts.slice(e*9-9,e*9)):this.products=this.allProducts.slice(e*9-9,e*9);const g=e!==1,i=e!==this.total_pages;this.pagination={total_pages:this.total_pages,current_page:e,has_pre:g,has_next:i,category:r},this.isLoading=!1},500)},getDetail(e){this.$router.push(`/product/${e}`)},addToCart(e){this.sendLoadingState(!0),this.data.product_id=e,P(this.data).then(()=>{this.sendLoadingState(!1),this.alert.msg="Product added to cart successfully!",this.alert.state=!0,this.sendMsg(),this.$emitter.emit("renewCart")}).catch(r=>{this.sendLoadingState(!1),[this.alert.msg]=r.response.data.message,this.alert.state=!1,this.sendMsg()})},toggleFav(e){if(!document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1")){this.alert.msg="You have to login first",this.alert.state=!1,this.sendMsg();return}const c=this.favProducts.findIndex(i=>i===e);c===-1?this.favProducts.push(e):this.favProducts.splice(c,1);const g=JSON.stringify(this.favProducts);localStorage.setItem("favList",g)},checkFav(e){return this.favProducts.includes(e)}}},B={class:"container mx-auto px-4 py-6 mt-[100px] md:mt-[150px]"},D={class:"flex justify-between items-center mb-12 flex-wrap"},M={class:"w-full md:w-1/2 mb-4 md:mb-0"},R={class:"flex flex-wrap"},j={class:"mr-3 mb-3 lg:mb-0"},I=["onClick"],O={class:"w-full md:w-auto mt-4 md:mt-0"},z={class:"relative w-full md:w-[200px] cursor-pointer group"},V={class:"truncate block pr-4"},$={class:"absolute left-0 right-0 rounded-lg z-30 bg-white mt-1 shadow-xl border border-gray-100 overflow-hidden",role:"listbox",tabindex:"-1"},Y=["onClick"],E={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 list-none p-0"},H={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 list-none p-0"},J={class:"mb-3 relative overflow-hidden group rounded-lg"},U=["src","alt"],G=["onClick"],K=["onClick"],Q=["onClick"],W={key:0,class:"absolute top-2 left-2 z-0 bg-light text-red-500 px-2 py-1 rounded shadow text-sm"},X=["onClick"],Z={key:0,class:"text-gray-500 mb-4"},tt={class:"line-through text-red-500 mr-2"},et={key:1,class:"text-gray-500 mb-4"},st=["onClick"];function ot(e,r,c,g,i,o){const d=y("SkeletonProduct"),_=y("BIconSuitHeartFill"),v=y("Pagination");return a(),l("main",B,[s("div",D,[s("div",M,[r[3]||(r[3]=s("p",{class:"text-left font-bold mb-2"}," FILTER BY ",-1)),s("ul",R,[s("li",j,[s("a",{href:"#",class:f(["inline-block px-5 py-2 rounded-full transition-colors duration-300",i.category.selected==="All"?"bg-primary text-secondary":"bg-secondary text-white hover:bg-primary hover:text-secondary"]),onClick:r[0]||(r[0]=u(t=>o.chooseCategory("All"),["prevent"]))},[...r[2]||(r[2]=[s("span",null,"All",-1)])],2)]),(a(!0),l(m,null,p(i.category.categories,t=>(a(),l("li",{class:"mr-3",key:t},[s("a",{href:"#",class:f(["inline-block px-5 py-2 rounded-full transition-colors duration-300",i.category.selected===t?"bg-primary text-secondary":"bg-secondary text-white hover:bg-primary hover:text-secondary"]),onClick:u(h=>o.chooseCategory(t),["prevent"])},[s("span",null,n(t),1)],10,I)]))),128))])]),s("div",O,[r[4]||(r[4]=s("label",{id:"sort-label",class:"text-left md:text-right block mb-2 font-bold text-gray-700"},"SORT BY",-1)),s("div",z,[s("div",{class:"bg-white py-2 px-6 rounded-lg shadow border border-gray-200 text-left relative select-none flex items-center justify-between hover:border-secondary transition-colors",onClick:r[1]||(r[1]=t=>i.sort.isShow=!i.sort.isShow),"aria-haspopup":"listbox","aria-labelledby":"sort-label"},[s("span",V,n(i.sort.selected),1),s("span",{class:f(["w-2 h-2 border-r-2 border-b-2 border-secondary transform rotate-45 transition-transform duration-300 flex-shrink-0",{"-rotate-[135deg] translate-y-1":i.sort.isShow}])},null,2)]),N(s("div",$,[(a(!0),l(m,null,p(i.sort.sorts,t=>(a(),l("div",{key:t,onClick:h=>o.chooseSort(t),class:"py-2 px-4 hover:bg-green-50 hover:text-secondary cursor-pointer transition-colors text-sm"},n(t),9,Y))),128))],512),[[A,i.sort.isShow]])])])]),i.isLoading?(a(),l("ul",E,[(a(),l(m,null,p(6,t=>s("li",{key:t},[b(d)])),64))])):(a(),l("ul",H,[(a(!0),l(m,null,p(i.products,t=>(a(),l("li",{class:"mb-7",key:t.id},[s("div",J,[s("img",{src:t.imageUrl,alt:t.title,class:"w-full h-[200px] object-cover object-center rounded-lg"},null,8,U),s("div",{class:"absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-all duration-300 cursor-pointer",role:"button",onClick:u(h=>o.getDetail(t.id),["self"])},null,8,G),s("div",{class:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-[150%] bg-gray-200 px-6 py-2 text-secondary rounded transition-transform duration-300 group-hover:-translate-y-[10%] cursor-pointer",role:"button",onClick:u(h=>o.getDetail(t.id),["self"])}," Check Details ",8,K),s("div",{class:"absolute top-4 right-4 z-10 cursor-pointer text-gray-300 hover:text-red-500 transition-colors",onClick:h=>o.toggleFav(t.id)},[b(_,{class:f(["w-6 h-6",{"text-red-500":o.checkFav(t.id)}])},null,8,["class"])],8,Q),t.price!==t.origin_price?(a(),l("div",W," On Sale ")):q("",!0)]),s("p",{class:"mb-1 cursor-pointer font-bold text-lg hover:text-secondary transition-colors",onClick:h=>o.getDetail(t.id)},n(t.title),9,X),t.price!==t.origin_price?(a(),l("p",Z,[s("span",tt," $"+n(t.origin_price),1),F(" $"+n(t.price)+" NTD / "+n(t.unit),1)])):(a(),l("p",et," $"+n(t.origin_price)+" NTD / "+n(t.unit),1)),s("a",{href:"",class:"inline-block bg-secondary text-white px-6 py-2 rounded-full hover:bg-opacity-90 transition-all duration-300 font-bold",onClick:u(h=>o.addToCart(t.id),["prevent"])},[...r[5]||(r[5]=[s("span",null,"Add to cart",-1)])],8,st)]))),128))])),b(v,{pagination:i.pagination,onSendRequest:o.getProducts},null,8,["pagination","onSendRequest"])])}const ct=L(T,[["render",ot]]);export{ct as default};
