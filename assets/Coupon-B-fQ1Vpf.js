import{a as _,s as T,t as B,v as I,w as O}from"./alertMixin-DyMZh6iB.js";import{l as E}from"./loadingMixin-CrgvWKu1.js";import{P as q}from"./Pagination-Bzx8p2PF.js";import{m as V,D as R}from"./DelModal-Bqwpp5m9.js";import{_ as C,c as l,a as u,o as a,b as e,t as m,f as p,v as f,G as j,w as h,g as r,F as y,r as J,d as c,h as P,j as F}from"./index-KAsS_BkG.js";const U={data(){return{cacheCoupon:{},due_date:0}},props:{coupon:{type:Object,default(){return{}}},state:{type:Boolean},isReadOnly:{type:Boolean,default:!1}},methods:{saveChange(){this.state?T(this.cacheCoupon).then(t=>{this.alert.msg=t.data.message,this.alert.state=!0,this.closeModal(),this.sendMsg(),this.sendRequest()}).catch(t=>{[this.alert.msg]=t.response.data.message,this.alert.state=!1,this.sendMsg()}):B(this.cacheCoupon.id,this.cacheCoupon).then(t=>{this.alert.msg=t.data.message,this.alert.state=!0,this.closeModal(),this.sendMsg(),this.sendRequest()}).catch(t=>{[this.alert.msg]=t.response.data.message,this.alert.state=!1,this.sendMsg()})},sendRequest(){this.$emit("send-request")}},watch:{coupon(){this.cacheCoupon=this.coupon;const t=new Date(this.cacheCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.cacheCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[V,_],emits:["send-request"]},L={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col relative"},$={class:"flex items-center justify-between p-4 border-b bg-primary rounded-t-lg"},A={class:"text-xl font-bold text-secondary"},X={class:"p-6 overflow-y-auto"},z={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},G={class:"col-span-1"},H={class:"col-span-1"},K={class:"col-span-1"},Q={class:"col-span-1"},W={class:"col-span-1 md:col-span-2 pt-4 border-t"},Y={class:"flex items-center"},Z=["checked"],ee={class:"p-4 border-t flex justify-end gap-2 bg-gray-50 rounded-b-lg"};function oe(t,o,g,x,s,i){return t.isModalOpen?(a(),l("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 transition-opacity",onClick:o[8]||(o[8]=h((...n)=>t.closeModal&&t.closeModal(...n),["self"]))},[e("div",L,[e("div",$,[e("h5",A,m(g.state?"Add New Coupon":"Edit Coupon"),1),e("button",{type:"button",class:"text-secondary hover:text-white text-2xl leading-none",onClick:o[0]||(o[0]=(...n)=>t.closeModal&&t.closeModal(...n)),"aria-label":"Close"}," Ã— ")]),e("div",X,[e("form",z,[e("div",G,[o[9]||(o[9]=e("label",{for:"title",class:"block mb-2 font-bold"},"Title",-1)),p(e("input",{type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary",id:"title",placeholder:"Coupon title","onUpdate:modelValue":o[1]||(o[1]=n=>s.cacheCoupon.title=n)},null,512),[[f,s.cacheCoupon.title]])]),e("div",H,[o[10]||(o[10]=e("label",{for:"code",class:"block mb-2 font-bold"},"Code",-1)),p(e("input",{type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary",id:"code",placeholder:"Coupon code","onUpdate:modelValue":o[2]||(o[2]=n=>s.cacheCoupon.code=n)},null,512),[[f,s.cacheCoupon.code]])]),e("div",K,[o[11]||(o[11]=e("label",{for:"due_date",class:"block mb-2 font-bold"},"Expired date",-1)),p(e("input",{type:"date",class:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary",id:"due_date","onUpdate:modelValue":o[3]||(o[3]=n=>s.due_date=n)},null,512),[[f,s.due_date]])]),e("div",Q,[o[12]||(o[12]=e("label",{for:"discount",class:"block mb-2 font-bold"},"Discount",-1)),p(e("input",{type:"number",class:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-primary",id:"discount",min:"0",placeholder:"Coupon discount","onUpdate:modelValue":o[4]||(o[4]=n=>s.cacheCoupon.percent=n)},null,512),[[f,s.cacheCoupon.percent,void 0,{number:!0}]])]),e("div",W,[e("div",Y,[p(e("input",{class:"mr-2 h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded",type:"checkbox","onUpdate:modelValue":o[5]||(o[5]=n=>s.cacheCoupon.is_enabled=n),id:"couponEnabledSwitch",checked:s.cacheCoupon.is_enabled===1,"true-value":1,"false-value":0},null,8,Z),[[j,s.cacheCoupon.is_enabled]]),o[13]||(o[13]=e("label",{class:"font-bold cursor-pointer",for:"couponEnabledSwitch"}," Enable coupon ",-1))])])])]),e("div",ee,[e("button",{type:"button",class:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors",onClick:o[6]||(o[6]=(...n)=>t.closeModal&&t.closeModal(...n))}," Close "),g.isReadOnly?u("",!0):(a(),l("button",{key:0,type:"button",class:"px-4 py-2 bg-primary text-secondary font-bold rounded hover:bg-opacity-90 transition-colors",onClick:o[7]||(o[7]=(...n)=>i.saveChange&&i.saveChange(...n))}," Save changes "))])])])):u("",!0)}const te=C(U,[["render",oe]]),se={data(){return{coupons:"",cacheCoupon:"",isNew:!0,isDemo:!1}},components:{Pagination:q,DelModal:R,CouponModal:te},methods:{getCoupons(t){if(this.isDemo){this.coupons={coupons:[{id:"demo-coupon-1",title:"Demo 50% Off",percent:50,due_date:Math.floor(new Date().getTime()/1e3)+864e3,is_enabled:1,code:"demo50"},{id:"demo-coupon-2",title:"Demo 10% Off",percent:10,due_date:Math.floor(new Date().getTime()/1e3)-86400,is_enabled:0,code:"demo10"}],pagination:{total_pages:1,current_page:1,has_pre:!1,has_next:!1}};return}this.sendLoadingState(!0),O(t).then(o=>{this.sendLoadingState(!1),this.coupons=o.data}).catch(()=>{this.sendLoadingState(!1),this.alert.msg="Fail to get the coupons",this.alert.state=!1,this.sendMsg()})},delCoupon(){I(this.cacheCoupon.id).then(t=>{this.alert.msg=t.data.message,this.alert.state=!0,this.$refs.delModal.closeModal(),this.sendMsg(),this.getCoupons()}).catch(t=>{[this.alert.msg]=t.response.data.message,this.alert.state=!1,this.$refs.delModal.closeModal(),this.sendMsg()})},modalToggle(t,o){t==="edit"?(this.cacheCoupon=JSON.parse(JSON.stringify(o)),this.isNew=!1,this.$refs.couponModal.openModal()):t==="del"?(this.cacheCoupon=JSON.parse(JSON.stringify(o)),this.$refs.delModal.openModal()):t==="view"?(this.cacheCoupon=JSON.parse(JSON.stringify(o)),this.isNew=!1,this.$refs.couponModal.openModal()):t==="new"&&(this.cacheCoupon={is_enabled:1,due_date:this.currentTime},this.isNew=!0,this.$refs.couponModal.openModal())}},created(){this.isDemo=localStorage.getItem("isDemo")==="true",this.getCoupons(),this.$emitter.on("send-request",t=>{this.getCoupons(t)})},computed:{currentTime(){return Math.floor(new Date().getTime()/1e3)}},mixins:[_,E]},ne={class:"bg-white w-full min-h-screen"},le={class:"container mx-auto px-4 py-8"},ae={class:"flex justify-end mb-6"},ie={class:"overflow-x-auto bg-white rounded-lg shadow"},de={class:"w-full table-auto text-center"},re={class:"text-gray-600 text-sm font-light"},ce={class:"py-3 px-6 text-left whitespace-nowrap font-medium"},ue={class:"py-3 px-6"},pe={class:"py-3 px-6"},he={key:0,class:"py-3 px-6"},fe={class:"text-green-500 font-bold"},me={key:1,class:"py-3 px-6"},ge={class:"text-gray-400"},be={class:"py-3 px-6"},ye={class:"flex item-center justify-center gap-4"},_e=["onClick"],Ce=["onClick"],xe=["onClick"],ve={class:"mt-6 flex justify-center"};function we(t,o,g,x,s,i){const n=c("BIconCheckCircle"),v=c("BIconXCircle"),w=c("BIconPen"),M=c("BIconTrash"),k=c("BIconEyeFill"),D=c("Pagination"),S=c("DelModal"),N=c("CouponModal");return a(),l(y,null,[e("main",ne,[e("div",le,[e("div",ae,[s.isDemo?u("",!0):(a(),l("button",{key:0,type:"button",class:"inline-block bg-secondary text-white px-6 py-2 rounded-lg hover:bg-opacity-90 transition-all duration-300 font-bold shadow-sm",onClick:o[0]||(o[0]=h(d=>i.modalToggle("new"),["prevent"]))}," Add new coupon "))]),e("div",ie,[e("table",de,[o[1]||(o[1]=e("thead",{class:"bg-gray-100 text-gray-600 uppercase text-sm leading-normal"},[e("tr",null,[e("th",{scope:"col",class:"py-3 px-6"}," Title "),e("th",{scope:"col",class:"py-3 px-6"}," Discount "),e("th",{scope:"col",class:"py-3 px-6"}," Expired date "),e("th",{scope:"col",class:"py-3 px-6"}," Enable "),e("th",{scope:"col",class:"py-3 px-6 text-center"}," Edit coupon ")])],-1)),e("tbody",re,[(a(!0),l(y,null,J(s.coupons.coupons,d=>(a(),l("tr",{key:d.id,class:"border-b border-gray-200 hover:bg-gray-50 transition-colors"},[e("td",ce,m(d.title),1),e("td",ue,m(d.percent)+"% off",1),e("td",pe,m(t.$filters.date(d.due_date)),1),d.is_enabled?(a(),l("td",he,[e("span",fe,[r(n,{class:"w-5 h-5 inline"})])])):(a(),l("td",me,[e("span",ge,[r(v,{class:"w-5 h-5 inline"})])])),e("td",be,[e("div",ye,[s.isDemo?u("",!0):(a(),l("button",{key:0,class:"transform hover:text-secondary hover:scale-110 transition-transform duration-300",onClick:h(b=>i.modalToggle("edit",d),["prevent"]),title:"Edit"},[r(w,{class:"w-5 h-5"})],8,_e)),s.isDemo?u("",!0):(a(),l("button",{key:1,class:"transform hover:text-red-500 hover:scale-110 transition-transform duration-300",onClick:h(b=>i.modalToggle("del",d),["prevent"]),title:"Delete"},[r(M,{class:"w-5 h-5"})],8,Ce)),s.isDemo?(a(),l("button",{key:2,class:"transform hover:text-secondary hover:scale-110 transition-transform duration-300",onClick:h(b=>i.modalToggle("view",d),["prevent"]),title:"View Details"},[r(k,{class:"w-5 h-5"})],8,xe)):u("",!0)])])]))),128))])])]),e("div",ve,[r(D,{pagination:s.coupons.pagination,onSendRequest:i.getCoupons},null,8,["pagination","onSendRequest"])])])]),r(S,{ref:"delModal",onDelItem:i.delCoupon,item:s.cacheCoupon},{default:P(()=>[...o[2]||(o[2]=[F(" Coupon ",-1)])]),_:1},8,["onDelItem","item"]),r(N,{ref:"couponModal",onSendRequest:i.getCoupons,coupon:s.cacheCoupon,state:s.isNew,"is-read-only":s.isDemo},null,8,["onSendRequest","coupon","state","is-read-only"])],64)}const Te=C(se,[["render",we]]);export{Te as default};
